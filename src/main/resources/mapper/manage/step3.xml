<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.scyllacore.dumpWeb.commonModule.db.mapper.manage.Step3ForDriveReportRegistrationMapper">

    <insert id="insertDriveReport" parameterType="DriveReportDTO">
        INSERT INTO drive_report_tb
        (DRIVE_DATE,
         CAR_NO,
         FROM_SITE,
         TO_SITE,
         ITEM,
         UNIT_PRICE,
         QUANTITY,
         MEMO,
         DRIVER_PAYMENT_CHK,
         PROGRESS,
         DRIVER_ID_FK,
         SUBMITTER_ID_FK,
         WRITER_ID_FK)
        VALUES (#{driveDate},
                #{carNo},
                #{fromSite},
                #{toSite},
                #{item},
                #{unitPrice},
                #{quantity},
                #{memo},
                #{driverPaymentChk},
                #{progress},
                #{driverIdFk},
                #{submitterIdFk},
                #{writerIdFk})
    </insert>


    <update id="updateDriveReport" parameterType="DriveReportDTO">
        UPDATE drive_report_tb
        SET DRIVE_DATE = #{driveDate},
        FROM_SITE = #{fromSite},
        TO_SITE = #{toSite},
        ITEM = #{item},
        QUANTITY = #{quantity},
        MEMO = #{memo},
        DRIVER_PAYMENT_CHK = #{driverPaymentChk},
        PROGRESS = #{progress}
        WHERE WRITER_ID_FK = #{writerIdFk}
        AND REPORT_ID = #{reportId}
        AND SUBMITTER_PAYMENT_CHK = 0
    </update>


    <delete id="deleteDriveReport">
        DELETE
        FROM drive_report_tb
        WHERE WRITER_ID_FK = #{writerIdFk}
          AND REPORT_ID = #{reportId}
          AND SUBMITTER_PAYMENT_CHK = 0
    </delete>

    <select id="selectDriveReportList" resultType="DriveReportDTO">
        SELECT DATE_FORMAT(DRIVE_DATE, '%Y.%m.%d') AS driveDate,
               FROM_SITE,
               TO_SITE,
               ITEM,
               UNIT_PRICE,
               QUANTITY,
               MEMO,
               DRIVER_PAYMENT_CHK,
               PROGRESS,
               SUBMITTER_ID_FK
        FROM drive_report_tb
        WHERE DRIVE_DATE BETWEEN #{driveDate} AND #{driveDate}
          AND REPORT_ID = #{reportId}
    </select>



    <select id="selectDriveReport" resultType="DriveReportDTO">
        SELECT DATE_FORMAT(DRIVE_DATE, '%Y.%m.%d') AS driveDate,
               FROM_SITE,
               TO_SITE,
               ITEM,
               UNIT_PRICE,
               QUANTITY,
               MEMO,
               DRIVER_PAYMENT_CHK,
               PROGRESS,
               SUBMITTER_ID_IDX
        FROM drive_report_tb
        WHERE WRITER_ID_IDX_FK = #{writerIdIdxFk}
          AND REPORT_IDX = #{reportIdx}
    </select>

</mapper>